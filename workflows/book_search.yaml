kind: process
version: "1"
metadata:
  name: book_search
  description: Search Open Library for books and authors
  risk: low
  principal:
    id: system:demo
    permissions:
      - read:http
  termination:
    maxNodes: 5
    maxRuntimeMs: 30000
    warnAtPct: 80

nodes:
  - id: search_books
    actionRef: plugin.http.get
    schemaVersion: v1
    input:
      url: https://openlibrary.org/search.json
      params:
        q: "{query}"
        limit: 5
        fields: "key,title,author_name,first_publish_year,subject,cover_i"
      headers:
        User-Agent: agentic-workflow-engine
    timeoutMs: 15000
    retry:
      maxAttempts: 2
      backoffMs: 1000

  - id: extract_books
    actionRef: plugin.transform.jq
    schemaVersion: v1
    dependsOn:
      - search_books
    input:
      data:
        $ref: $.nodes.search_books.output.body
      expression: ".docs"
